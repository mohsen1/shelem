<!DOCTYPE html>
<html>
<head>
<script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Shelem Tracker</title>
  <style type="text/css">
    html,
    body {
      font-family: sans-serif;
      padding: 0;
      margin: 0;
      height: 100vh;
    }
    .shelem {
      width: 100vw;
      height: 100vh;
    }
    .shelem header {
      display: flex;
      background: gray;
      color: white;
      padding: .2em;
    }
    .shelem header > div {
      flex: 1;
      text-align: center;
    }
    .shelem .rounds {
      display: block;
    }
    .shelem .rounds .round {
      display: flex;
      padding: .3em;
    }
    .shelem .rounds .round div {
      flex: 1;
      text-align: center;
    }
    .shelem .calls,
    .shelem .results {
      padding-bottom: 2em;
      display: flex;
    }
    .shelem .calls form,
    .shelem .results form {
      flex: 1;
      text-align: center;
    }
    .shelem .calls form input,
    .shelem .results form input,
    .shelem .calls form .called,
    .shelem .results form .called {
      text-align: center;
      display: block;
      width: 100%;
      padding: .5em;
    }
    button.submit {
      display: inline-block;
      min-width: 4em;
      border: 1px solid transparent;
    }
    .shelem footer {
      background: #eee;
      text-align: center;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    .shelem footer .teams {
      padding: .3em;
      display: flex;
    }
    .shelem footer .teams div {
      flex: 1;
    }
  </style>
</head>
<body ng-app>
  <div class="shelem" ng-controller="ShelemCtrl">
    <header>
      <div>Team A</div>
      <div>Team B</div>
    </header>
    <div class="rounds">
      <div class="round" ng-repeat="round in rounds">
        <div>{{round.a.score}}</div>
        <div>{{round.b.score}}</div>
      </div>
    </div>
    <div class="calls" ng-hide="teamWhoCalled">
      <form ng-submit="call('a')">
        <input type="number" min="100" max="165" step="5" placeholder="Enter call of Team A" ng-model="callA">
        <button class='submit' ng-click="call('a')">Call</button>
      </form>
      <form ng-submit="call('b')">
        <input type="number" min="100" max="165" step="5" placeholder="Enter call of Team B" ng-model="callB">
        <button class='submit' ng-click="call('b')">Call</button>
      </form>
    </div>
    <div class="results" ng-hide="!teamWhoCalled">
      <form ng-submit="submit('a')">
        <input type="number" min="0" max="165" step="5" ng-model="submitA" ng-hide="teamWhoCalled.team !== 'b'" placeholder="Points Team A collected">
        <button class="submit" ng-hide="teamWhoCalled.team === 'a'" ng-click="submit('a')">Submit</button>
        <div class="called"  ng-if="teamWhoCalled.team === 'a'">Team A called for {{teamWhoCalled.points}}</div>
      </form>
      <form ng-submit="submit('b')">
        <input type="number" min="0" max="165" step="5" ng-model="submitB" ng-hide="teamWhoCalled.team !== 'a'" placeholder="Points Team B collected">
        <button class="submit" ng-hide="teamWhoCalled.team === 'b'" ng-click="submit('a')">Submit</button>
        <div class="called"  ng-if="teamWhoCalled.team === 'b'">Team B called for {{teamWhoCalled.points}}</div>
      </form>
    </div>
    <footer>
       <div class="teams">
         <div>{{getTotal('a')}}</div>
         <div>{{getTotal('b')}}</div>
       </div>
    </footer>
  </div>
  <script>
    function ShelemCtrl($scope){
      $scope.teamWhoCalled = null;
      $scope.rounds = [];

      function reset(){
        $scope.teamWhoCalled = null;
        $scope.callA = $scope.callB =
        $scope.submitA = $scope.submitB = '';
      }

      $scope.getTotal = function(team){
        return $scope.rounds.reduce(function(score, round){
          return score + round[team].score;
        }, 0);
      };

      $scope.call = function(team){
        var points = parseInt(team == 'a' ? $scope.callA : $scope.callB, 10);
        if (Number.isNaN(points) || (points > 165 || points < 100 || points % 5 !== 0)) {
          return alert('Invalid Call');
        }
        $scope.teamWhoCalled = { team: team, points: points };
      };

      $scope.submit = function(team){
        var round, score;
        var submitted = parseInt(team == 'a' ? $scope.submitA : $scope.submitB, 10);
        if(isNaN(submitted) || submitted > 165 || submitted < 0 || submitted % 5 !== 0) {
          return alert('Invalid number');
        }
        score = 165 - submitted;
        if(score < $scope.teamWhoCalled.points){
          score = -$scope.teamWhoCalled.points;
        }
        if(team == 'b'){
          round = { a: {score: score}, b: {score: submitted} };
        } else {
          round = { a: {score: submitted}, b: {score: score} };
        }
        $scope.rounds.push(round);
        reset();
      };
    }
  </script>
</body>
</html>